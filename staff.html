<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é †ç•ªç®¡ç†ï¼ˆåº—å“¡ç”¨ï¼‰</title>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f2f2f2;
      padding: 15px;
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
    }
    .box {
      background: #fff;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      flex-wrap: wrap;
      gap: 6px;
    }
    button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .mail { background: #1976d2; color: #fff; }
    .delete { background: #999; color: #fff; }
  </style>
</head>

<body>
<h1>é †ç•ªç®¡ç†ï¼ˆåº—å“¡ç”¨ï¼‰</h1>
<div id="list"></div>

<script>
  const KEY = "waitlist";

  emailjs.init({
    publicKey: "jRUkbLl4MWL20uTZR"
  });

  function load() {
    const list = JSON.parse(localStorage.getItem(KEY) || "[]");
    const area = document.getElementById("list");
    area.innerHTML = "";

    if (list.length === 0) {
      area.innerHTML = "<div class='box'>ç¾åœ¨ãŠå¾…ã¡ã®ãŠå®¢æ§˜ã¯ã„ã¾ã›ã‚“</div>";
      return;
    }

    list.forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "box";
      div.innerHTML = `
        <div class="row">
          <b>${item.name} æ§˜</b>
          <span>${item.count}å</span>
        </div>
        <div class="row">
          å°å­¦ç”Ÿä»¥ä¸‹ï¼š${item.kids === "4" ? "4äººä»¥ä¸Š" : item.kids}
          ï¼ å­ä¾›ã„ã™ï¼š${item.chair}
        </div>
        <div class="row">
          ${item.email ? "âœ‰ï¸ " + item.email : "ğŸ“¢ åº—é ­å‘¼ã³å‡ºã—"}
        </div>
        <div class="row">
          <button class="mail" onclick="sendMail(${index})">ãƒ¡ãƒ¼ãƒ«</button>
          <button class="delete" onclick="removeItem(${index})">æ¶ˆå»</button>
        </div>
      `;
      area.appendChild(div);
    });
  }

  function sendMail(index) {
    const list = JSON.parse(localStorage.getItem(KEY) || "[]");
    const c = list[index];

    if (!c.email) {
      alert("ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’å¸Œæœ›ã—ã¦ã„ã¾ã›ã‚“");
      return;
    }

    emailjs.send("service_a01ep2i", "template_mgk6u3t", {
      to_email: c.email,
      to_name: c.name,
      message: "é †ç•ªãŒè¿‘ã¥ã„ã¦ã„ã¾ã™ã€‚ãŠåº—ã®è¿‘ãã§ãŠå¾…ã¡ãã ã•ã„ã€‚"
    }).then(
      () => alert("ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ"),
      () => alert("ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ")
    );
  }

  function removeItem(index) {
    if (!confirm("æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) return;
    const list = JSON.parse(localStorage.getItem(KEY) || "[]");
    list.splice(index, 1);
    localStorage.setItem(KEY, JSON.stringify(list));
    load();
  }

  load();
  setInterval(load, 3000);
</script>
</body>
</html>
