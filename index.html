<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é †ç•ªå¾…ã¡å—ä»˜</title>

<style>
*{box-sizing:border-box;}
body{
  font-family:system-ui;
  background:#f7f7f7;
  padding:10px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:20px;
  max-width:420px;
  margin:auto;
}
h2{text-align:center;}
label{display:block;margin-top:14px;font-weight:600;}
input,select,textarea,button{
  width:100%;
  padding:14px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:16px;
}
textarea{resize:vertical;}
.notify-btn{
  margin-top:16px;
  padding:16px;
  border-radius:12px;
  text-align:center;
  font-weight:bold;
  cursor:pointer;
  border:2px solid #ff6b00;
  color:#ff6b00;
}
.notify-btn.active{
  background:#ff6b00;
  color:#fff;
}
.notice{
  margin-top:14px;
  padding:12px;
  background:#fff3e0;
  border-radius:10px;
  font-size:14px;
  color:#c05600;
}
button{
  background:#ff6b00;
  color:#fff;
  border:none;
  margin-top:20px;
  font-size:18px;
  font-weight:bold;
}
.result{text-align:center;margin-top:16px;}
</style>
</head>

<body>
<div class="card">
<h2>ç„¼è‚‰ã˜ã‚…ã‚“ é †ç•ªå¾…ã¡ã‚·ã‚¹ãƒ†ãƒ </h2>

<div id="waitTime" style="
  background:#fff3e0;
  padding:14px;
  border-radius:12px;
  text-align:center;
  margin-bottom:16px;
  font-weight:bold;">
  å¾…ã¡æ™‚é–“ã‚’ç¢ºèªä¸­ã§ã™â€¦
</div>

<label>ãŠåå‰ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰</label>
<input id="name" placeholder="ãƒ¤ãƒãƒ€ ã‚¸ãƒ¥ãƒ³">

<label>äººæ•°</label>
<input type="number" id="count" min="1">

<div id="notifyBtn" class="notify-btn" onclick="toggleMail()">
ğŸ“© é †ç•ªãŒè¿‘ã¥ã„ãŸã‚‰ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥
</div>

<div id="mailArea" style="display:none;">
  <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
  <input type="email" id="email">
</div>

<label>å°å­¦ç”Ÿä»¥ä¸‹ã®äººæ•°</label>
<select id="kids">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4äººä»¥ä¸Š</option>
</select>

<label>å­ä¾›ã„ã™ã®å€‹æ•°</label>
<input type="number" id="chair" min="0" value="0">

<label>ãã®ä»–ï¼ˆã”è¦æœ›ãªã©ï¼‰</label>
<textarea id="note" rows="3"></textarea>

<div class="notice">
â€» ãŠå‘¼ã³å‡ºã—å¾Œ15åˆ†ã”ä¸åœ¨ã®å ´åˆã€è‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¨ãªã‚Šã¾ã™ã€‚
</div>

<button type="button" onclick="register()">å—ä»˜ã™ã‚‹</button>
<div class="result" id="result"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const app = initializeApp({
  databaseURL:"https://zyunule-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = getDatabase(app);

/* ===== DOM ===== */
const nameInput = document.getElementById("name");
const countInput = document.getElementById("count");
const emailInput = document.getElementById("email");
const notifyBtn = document.getElementById("notifyBtn");
const mailArea = document.getElementById("mailArea");
const result = document.getElementById("result");

/* ===== å¾…ã¡æ™‚é–“è¡¨ç¤º ===== */
const waitTimeArea = document.getElementById("waitTime");
const format = min => {
  const h=Math.floor(min/60), m=min%60;
  if(h===0) return `${m}åˆ†`;
  if(m===0) return `${h}æ™‚é–“`;
  return `${h}æ™‚é–“${m}åˆ†`;
};

onValue(ref(db,"status/waitTime"), snap=>{
  const d=snap.val();
  if(!d){
    waitTimeArea.textContent="ç¾åœ¨ã®å¾…ã¡æ™‚é–“ã¯è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“";
    return;
  }
  waitTimeArea.innerHTML=`ãŸã ã„ã¾ã®å¾…ã¡æ™‚é–“ã¯<br>ç´„ ${format(d.min)} ï½ ${format(d.max)} ã§ã™`;
});

/* ===== ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ ===== */
let useMail=false;
window.toggleMail=()=>{
  useMail=!useMail;
  notifyBtn.classList.toggle("active",useMail);
  mailArea.style.display=useMail?"block":"none";
};

/* ===== å—ä»˜ ===== */
window.register=()=>{
  const name=nameInput.value.trim();
  const count=Number(countInput.value);
  const email=emailInput.value.trim();

  if(!name||!count) return alert("å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  if(count>=7){
    result.innerHTML=`<div style="background:#fff3cd;padding:14px;border-radius:10px;">
      äººæ•°ã®é–¢ä¿‚ä¸Šã€ã‚¹ã‚¿ãƒƒãƒ•ã«ãŠå£°ãŒã‘ãã ã•ã„ã€‚
    </div>`;
    return;
  }

  if(useMail && !email) return alert("ãƒ¡ãƒ¼ãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  push(ref(db,"waitlist"),{
    name,
    count,
    kids:kids.value,
    chair:chair.value,
    note:note.value,
    email:useMail?email:"",
    time:Date.now()
  });

  result.innerHTML=`<b>${name}æ§˜</b><br>å—ä»˜ã—ã¾ã—ãŸ`;
};
</script>
</body>
</html>
