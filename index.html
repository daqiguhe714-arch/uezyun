<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é †ç•ªå¾…ã¡å—ä»˜</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'Hiragino Mincho ProN','Yu Mincho','serif','Hiragino Sans',system-ui,sans-serif;
  background:#fff;
  min-height:100vh;
  padding:0;
  color:#2c2c2c;
}
.container{
  max-width:500px;
  margin:0 auto;
  min-height:100vh;
  background:#fff;
}
.header{
  background:#fff;
  padding:48px 24px 40px;
  text-align:center;
  border-bottom:1px solid #e0e0e0;
}
.header h1{
  font-size:32px;
  color:#2c2c2c;
  margin-bottom:12px;
  font-weight:500;
  letter-spacing:3px;
  font-family:'Hiragino Mincho ProN','Yu Mincho',serif;
}
.header .subtitle{
  font-size:13px;
  color:#666;
  font-weight:400;
  letter-spacing:2px;
  font-family:'Hiragino Sans',system-ui,sans-serif;
}

.wait-time{
  background:#fff;
  color:#2c2c2c;
  padding:32px 24px;
  text-align:center;
  border-bottom:1px solid #e0e0e0;
  display:none;
}
.wait-time.show{
  display:block;
}
.wait-time .label{
  font-size:12px;
  color:#999;
  margin-bottom:14px;
  font-weight:500;
  letter-spacing:1.5px;
  text-transform:uppercase;
  font-family:'Hiragino Sans',system-ui,sans-serif;
}
.wait-time .time{
  font-size:36px;
  font-weight:400;
  color:#2c2c2c;
  letter-spacing:2px;
  font-family:'Hiragino Mincho ProN','Yu Mincho',serif;
}

.card{
  padding:36px 28px 44px;
}

.form-group{
  margin-bottom:32px;
}
.form-group label{
  display:block;
  font-weight:500;
  color:#2c2c2c;
  margin-bottom:12px;
  font-size:14px;
  letter-spacing:0.5px;
}
.form-group .required{
  color:#8b0000;
  font-size:11px;
  margin-left:6px;
  background:#f5f5f5;
  padding:3px 9px;
  border-radius:3px;
  font-weight:500;
  border:1px solid #e0e0e0;
}
.form-group input,
.form-group select,
.form-group textarea{
  width:100%;
  padding:16px;
  border:1px solid #d0d0d0;
  border-radius:4px;
  font-size:16px;
  transition:all 0.3s;
  font-family:inherit;
  background:#fafafa;
  color:#2c2c2c;
}
.form-group input::placeholder,
.form-group textarea::placeholder{
  color:#999;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus{
  outline:none;
  border-color:#2c2c2c;
  background:#fff;
  box-shadow:0 0 0 3px rgba(44,44,44,0.05);
}
.form-group textarea{
  resize:vertical;
  min-height:100px;
  line-height:1.7;
}

.help-text{
  font-size:12px;
  color:#777;
  margin-top:10px;
  line-height:1.7;
  padding-left:4px;
}

.notify-toggle{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:22px;
  background:#fff;
  border-radius:4px;
  cursor:pointer;
  transition:all 0.3s;
  margin-bottom:32px;
  border:1px solid #e0e0e0;
  user-select:none;
}
.notify-toggle:active{
  transform:scale(0.99);
}
.notify-toggle.active{
  background:#fafafa;
  border-color:#999;
}
.notify-toggle .left{
  display:flex;
  align-items:center;
  gap:14px;
  pointer-events:none;
}
.notify-toggle .icon{
  font-size:24px;
  opacity:0.5;
  transition:all 0.3s;
}
.notify-toggle.active .icon{
  opacity:1;
}
.notify-toggle .text{
  font-weight:500;
  color:#2c2c2c;
  font-size:14px;
}
.notify-toggle .switch{
  width:54px;
  height:30px;
  background:#d0d0d0;
  border-radius:15px;
  position:relative;
  transition:all 0.3s;
  pointer-events:none;
}
.notify-toggle.active .switch{
  background:#2c2c2c;
}
.notify-toggle .switch::after{
  content:'';
  position:absolute;
  width:24px;
  height:24px;
  background:#fff;
  border-radius:50%;
  top:3px;
  left:3px;
  transition:all 0.3s;
  box-shadow:0 2px 4px rgba(0,0,0,0.15);
}
.notify-toggle.active .switch::after{
  left:27px;
}

.email-area{
  max-height:0;
  overflow:hidden;
  transition:max-height 0.4s ease, opacity 0.3s ease;
  opacity:0;
}
.email-area.show{
  max-height:140px;
  margin-bottom:32px;
  opacity:1;
}

.notice-box{
  background:#f9f9f9;
  border-left:3px solid #666;
  padding:20px 22px;
  border-radius:4px;
  margin:32px 0;
}
.notice-box .title{
  font-weight:600;
  color:#2c2c2c;
  margin-bottom:10px;
  font-size:14px;
  letter-spacing:0.5px;
}
.notice-box .text{
  font-size:13px;
  color:#555;
  line-height:1.9;
}

.submit-btn{
  width:100%;
  padding:20px;
  background:#2c2c2c;
  color:#fff;
  border:none;
  border-radius:4px;
  font-size:16px;
  font-weight:500;
  cursor:pointer;
  transition:all 0.3s;
  letter-spacing:3px;
  text-transform:uppercase;
  font-family:'Hiragino Sans',system-ui,sans-serif;
}
.submit-btn:active{
  background:#1a1a1a;
  transform:translateY(1px);
}

.modal-overlay{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.7);
  z-index:1000;
  animation:fadeIn 0.3s ease;
}
.modal-overlay.show{
  display:flex;
  align-items:center;
  justify-content:center;
}
.modal{
  background:#fff;
  border-radius:12px;
  padding:48px 36px;
  max-width:400px;
  width:90%;
  text-align:center;
  animation:slideUp 0.4s ease;
  box-shadow:0 10px 40px rgba(0,0,0,0.3);
}
.modal .checkmark{
  font-size:72px;
  margin-bottom:24px;
  animation:scaleIn 0.5s ease 0.2s both;
}
.modal .title{
  font-size:28px;
  font-weight:500;
  color:#2c2c2c;
  margin-bottom:20px;
  letter-spacing:2px;
  font-family:'Hiragino Mincho ProN','Yu Mincho',serif;
}
.modal .message{
  font-size:15px;
  color:#555;
  line-height:1.9;
  margin-bottom:28px;
}
.modal .menu-link{
  display:inline-block;
  padding:14px 32px;
  background:#2c2c2c;
  color:#fff;
  text-decoration:none;
  border-radius:4px;
  font-weight:500;
  letter-spacing:2px;
  transition:all 0.3s;
}
.modal .menu-link:hover{
  background:#1a1a1a;
}

.warning-box{
  background:#f9f9f9;
  border-left:3px solid #666;
  padding:24px;
  border-radius:4px;
  margin-top:28px;
  border:1px solid #d0d0d0;
}
.warning-box .title{
  font-weight:600;
  color:#2c2c2c;
  margin-bottom:12px;
  font-size:15px;
  letter-spacing:0.5px;
}
.warning-box .text{
  color:#555;
  line-height:1.9;
  font-size:14px;
}

.closed-message{
  display:none;
  text-align:center;
  padding:60px 28px;
  background:#f9f9f9;
  border-radius:8px;
  margin:40px 28px;
}
.closed-message.show{
  display:block;
}
.closed-message .icon{
  font-size:64px;
  margin-bottom:24px;
}
.closed-message .title{
  font-size:24px;
  font-weight:500;
  color:#2c2c2c;
  margin-bottom:16px;
  letter-spacing:1px;
  font-family:'Hiragino Mincho ProN','Yu Mincho',serif;
}
.closed-message .text{
  font-size:15px;
  color:#555;
  line-height:1.9;
}

@keyframes fadeIn{
  from{opacity:0;}
  to{opacity:1;}
}

@keyframes slideUp{
  from{opacity:0;transform:translateY(30px);}
  to{opacity:1;transform:translateY(0);}
}

@keyframes scaleIn{
  from{opacity:0;transform:scale(0.5);}
  to{opacity:1;transform:scale(1);}
}

::-webkit-scrollbar{
  width:8px;
}
::-webkit-scrollbar-track{
  background:#fff;
}
::-webkit-scrollbar-thumb{
  background:#d0d0d0;
  border-radius:4px;
}
::-webkit-scrollbar-thumb:hover{
  background:#bbb;
}

@media(max-width:480px){
  .header{padding:40px 20px 32px;}
  .header h1{font-size:28px;letter-spacing:2px;}
  .wait-time{padding:28px 20px;}
  .wait-time .time{font-size:32px;}
  .card{padding:28px 20px 36px;}
  .modal{padding:40px 28px;}
  .modal .title{font-size:24px;}
}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>ç„¼è‚‰ã˜ã‚…ã‚“æšæ–¹å¸‚å½¹æ‰€å‰åº—</h1>
    <div class="subtitle">é †ç•ªå¾…ã¡å—ä»˜ã‚·ã‚¹ãƒ†ãƒ </div>
  </div>

  <div class="wait-time" id="waitTime">
    <div class="label">ãŸã ã„ã¾ã®å¾…ã¡æ™‚é–“</div>
    <div class="time">ç¢ºèªä¸­â€¦</div>
  </div>

  <!-- å—ä»˜åœæ­¢ä¸­ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <div class="closed-message" id="closedMessage">
    <div class="icon"></div>
    <div class="title">é †ç•ªå¾…ã¡å—ä»˜åœæ­¢ä¸­</div>
    <div class="text">
      ãŸã ã„ã¾é †ç•ªå¾…ã¡ã¯ã”ã–ã„ã¾ã›ã‚“ã€‚<br>
      ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§ãŠå£°ãŒã‘ãã ã•ã„ã€‚
    </div>
  </div>

  <div class="card" id="formCard">
    <div class="form-group">
      <label>ãŠåå‰ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰<span class="required">å¿…é ˆ</span></label>
      <input type="text" id="name" placeholder="ãƒ¤ãƒãƒ€ ã‚¸ãƒ¥ãƒ³">
    </div>

    <div class="form-group">
      <label>äººæ•°<span class="required">å¿…é ˆ</span></label>
      <input type="number" id="count" min="1" placeholder="2">
      <div class="help-text">â€» 7åæ§˜ä»¥ä¸Šã®å ´åˆã¯ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§ãŠå£°ãŒã‘ãã ã•ã„</div>
    </div>

    <div class="notify-toggle" id="notifyBtn">
      <div class="left">
        <div class="icon">ğŸ“§</div>
        <div class="text">é †ç•ªãŒè¿‘ã¥ã„ãŸã‚‰ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥</div>
      </div>
      <div class="switch"></div>
    </div>

    <div class="email-area" id="emailArea">
      <div class="form-group">
        <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="required">å¿…é ˆ</span></label>
        <input type="email" id="email" placeholder="example@email.com">
      </div>
    </div>

    <div class="form-group">
      <label>å°å­¦ç”Ÿä»¥ä¸‹ã®äººæ•°</label>
      <select id="kids">
        <option value="0">0äºº</option>
        <option value="1">1äºº</option>
        <option value="2">2äºº</option>
        <option value="3">3äºº</option>
        <option value="4">4äººä»¥ä¸Š</option>
      </select>
    </div>

    <div class="form-group">
      <label>å­ä¾›ã„ã™ã®å€‹æ•°</label>
      <input type="number" id="chair" min="0" value="0" placeholder="0">
      <div class="help-text">æ•°ã«é™ã‚ŠãŒã”ã–ã„ã¾ã™ã®ã§ã€ã”ç”¨æ„ã§ããªã„å ´åˆãŒã”ã–ã„ã¾ã™</div>
    </div>

    <div class="form-group">
      <label>ãã®ä»–ã”è¦æœ›</label>
      <textarea id="note" placeholder="ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã€å¸­ã®ã”å¸Œæœ›ãªã©"></textarea>
    </div>

    <div class="notice-box">
      <div class="title">âš ï¸ ã”æ³¨æ„ãã ã•ã„</div>
      <div class="text">ãŠå‘¼ã³å‡ºã—å¾Œ15åˆ†é–“ã”ä¸åœ¨ã®å ´åˆã€è‡ªå‹•çš„ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¨ãªã‚Šã¾ã™ã€‚äºˆã‚ã”äº†æ‰¿ãã ã•ã„ã€‚</div>
    </div>

    <button class="submit-btn" id="submitBtn">å—ä»˜ã™ã‚‹</button>

    <div class="warning-box" id="warningBox" style="display:none;">
      <div class="title">âš ï¸ å¤§äººæ•°ã®ã”äºˆç´„ã«ã¤ã„ã¦</div>
      <div class="text">7åæ§˜ä»¥ä¸Šã®ã”äºˆç´„ã¯ã€ãŠæ‰‹æ•°ã§ã™ãŒç›´æ¥ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§ãŠå£°ãŒã‘ãã ã•ã„ã€‚ã”å”åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="checkmark">âœ“</div>
    <div class="title" id="modalName"></div>
    <div class="message">
      å—ä»˜ãŒå®Œäº†ã—ã¾ã—ãŸï¼<br>
      é †ç•ªãŒè¿‘ã¥ãã¾ã—ãŸã‚‰ãŠå‘¼ã³ã„ãŸã—ã¾ã™ã€‚
    </div>
    <a href="https://daqiguhe714-arch.github.io/hizyunmenyu/" class="menu-link">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹</a>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const app = initializeApp({
  databaseURL:"https://zyunule-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db = getDatabase(app);

document.addEventListener('DOMContentLoaded', () => {
  const nameInput = document.getElementById("name");
  const countInput = document.getElementById("count");
  const emailInput = document.getElementById("email");
  const notifyBtn = document.getElementById("notifyBtn");
  const emailArea = document.getElementById("emailArea");
  const waitTime = document.getElementById("waitTime");
  const kidsSelect = document.getElementById("kids");
  const chairInput = document.getElementById("chair");
  const noteInput = document.getElementById("note");
  const modalOverlay = document.getElementById("modalOverlay");
  const modalName = document.getElementById("modalName");
  const warningBox = document.getElementById("warningBox");
  const formCard = document.getElementById("formCard");
  const closedMessage = document.getElementById("closedMessage");

  /* ===== ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ…‹ã®ç›£è¦– ===== */
  onValue(ref(db,"status/isOpen"), snap=>{
    const isOpen = snap.val();
    
    if(isOpen){
      // å—ä»˜å¯èƒ½
      formCard.style.display = 'block';
      closedMessage.classList.remove('show');
      waitTime.classList.add('show');
    } else {
      // å—ä»˜åœæ­¢ä¸­
      formCard.style.display = 'none';
      closedMessage.classList.add('show');
      waitTime.classList.remove('show');
    }
  });

  /* ===== å¾…ã¡æ™‚é–“è¡¨ç¤º ===== */
  const format = min => {
    const h=Math.floor(min/60), m=min%60;
    if(h===0) return `${m}åˆ†`;
    if(m===0) return `${h}æ™‚é–“`;
    return `${h}æ™‚é–“${m}åˆ†`;
  };

  onValue(ref(db,"status/waitTime"), snap=>{
    const d=snap.val();
    if(!d){
      waitTime.innerHTML=`<div class="label">ãŸã ã„ã¾ã®å¾…ã¡æ™‚é–“</div><div class="time">ãŠå•ã„åˆã‚ã›ãã ã•ã„</div>`;
      return;
    }
    waitTime.innerHTML=`<div class="label">ãŸã ã„ã¾ã®å¾…ã¡æ™‚é–“</div><div class="time">${format(d.min)} ï½ ${format(d.max)}</div>`;
  });

  /* ===== ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ ===== */
  let useMail=false;
  const toggleMail=()=>{
    useMail=!useMail;
    notifyBtn.classList.toggle("active");
    emailArea.classList.toggle("show");
  };

  notifyBtn.addEventListener("click", toggleMail);

  /* ===== å—ä»˜ ===== */
  const register=()=>{
    const name=nameInput.value.trim();
    const count=Number(countInput.value);
    const email=emailInput.value.trim();

    if(!name||!count){
      alert("ãŠåå‰ã¨äººæ•°ã¯å¿…é ˆé …ç›®ã§ã™");
      return;
    }

    if(count>=7){
      warningBox.style.display='block';
      warningBox.scrollIntoView({behavior:'smooth',block:'center'});
      setTimeout(()=>{
        warningBox.style.display='none';
      },5000);
      return;
    }

    if(useMail && !email){
      alert("ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’å¸Œæœ›ã•ã‚Œã‚‹å ´åˆã¯ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }

    push(ref(db,"waitlist"),{
      name,
      count,
      kids:kidsSelect.value,
      chair:chairInput.value,
      note:noteInput.value,
      email:useMail?email:"",
      time:Date.now()
    });

    modalName.textContent = `${name} æ§˜`;
    modalOverlay.classList.add("show");
    
    nameInput.value='';
    countInput.value='';
    emailInput.value='';
    kidsSelect.value='0';
    chairInput.value='0';
    noteInput.value='';
    if(useMail) toggleMail();

    setTimeout(()=>{
      modalOverlay.classList.remove("show");
    },4000);
  };

  modalOverlay.addEventListener("click", (e)=>{
    if(e.target === modalOverlay){
      modalOverlay.classList.remove("show");
    }
  });

  document.getElementById("submitBtn").addEventListener("click", register);
});
</script>
</body>
</html>